(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.depot"],{"00d5":function(t,e,r){},"0e9a":function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));r("4de4"),r("a630"),r("3ca3"),r("caad"),r("2532"),r("2ca0");var a=function(t,e){return null!==e&&void 0!==e&&e.length?Array.from(t).filter((function(t){var r=t.type;return e.includes(r)})):Array.from(t).filter((function(t){var e=t.type;return e.startsWith("image/")}))}},7813:function(t,e,r){"use strict";r("a5f8")},8679:function(t,e,r){"use strict";var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("img",{staticClass:"arkn-item mdui-m-r-1 no-sl no-pe",style:{width:t.widthCss,height:t.widthCss},attrs:{src:t.$root.materialImage(t.img),crossorigin:"anonymous"},on:{error:t.handleImgErr}})},i=[],n=(r("a9e3"),{name:"arkn-item",props:{img:String,width:{type:[Number,String],default:48}},computed:{widthCss:function(){return"number"===typeof this.width?"".concat(this.width,"px"):this.width}},methods:{handleImgErr:function(t){t.target.src=this.$root.avatar("no_image"),t.target.style.backgroundColor="#bdbdbd",t.target.style.borderRadius="50%"}}}),s=n,u=(r("7813"),r("0c7c")),o=Object(u["a"])(s,a,i,!1,null,"7e63f491",null);e["a"]=o.exports},a3d0:function(t,e,r){"use strict";r.r(e);var a,i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"arkn-depot"}},[t.drImg.src?[r("div",{staticClass:"mdui-typo-body-2 mdui-m-b-1 no-sl"},[t._v(t._s(t.$t("depot.result.tip")))]),r("div",{staticClass:"result"},[r("div",{ref:"resultScrollable",staticClass:"result-scrollable",style:{"overflow-x":t.isDrProcessing?"hidden":""},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.handleUseFiles(e.dataTransfer.files)}.apply(null,arguments)},contextmenu:function(t){t.preventDefault()},wheel:t.onScrollResult}},[r("div",{staticClass:"result-wrapper",style:t.resultWrapperStyle},[r("div",{staticClass:"result-container",style:{backgroundImage:"url("+(t.drImg.src||t.PNG1P)+")",paddingBottom:100/t.drImgRatio+"%"}},[t._l(t.drData,(function(e,a){var i=e.view,n=e.sim,s=e.num;return[n&&s&&(n.diff<=t.MAX_SHOW_DIFF||t.isTrustedResult(n))?r("div",{key:a,staticClass:"result-square pointer",class:{disabled:!t.drSelect[a]},style:t.viewNumToPct(i),on:{click:function(e){return e.target!==e.currentTarget?null:t.$set(t.drSelect,a,!t.drSelect[a])},contextmenu:function(e){return e.preventDefault(),t.editResult(a)}}},[r("div",{staticClass:"result-sim mdui-valign",class:{"mdui-ripple mdui-ripple-white":t.drSelect[a]},on:{click:function(e){return t.editResult(a)}}},[r("arkn-item",{staticClass:"result-sim-img",attrs:{t:t.materialTable[n.name].rare,img:n.name,width:""}}),r("div",{staticClass:"result-sim-num no-pe no-sl"},[t._v(t._s(s.value))])],1),s.warn&&!s.edit?r("div",{staticClass:"result-sim-warn no-sl no-pe"},[t._v("⚠️")]):t._e()]):t._e()]}))],2)]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.$_.size(t.drData),expression:"$_.size(drData)"}],staticClass:"debug-checkbox-wrapper"},[r("mdui-checkbox",{staticClass:"debug-checkbox",model:{value:t.debug,callback:function(e){t.debug=e},expression:"debug"}},[t._v("Debug")])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isDrProcessing&&!t.drError,expression:"isDrProcessing && !drError"}],staticClass:"result-progress"},[r("mdui-spinner",{staticClass:"mdui-m-r-1",attrs:{colorful:!0}}),r("div",{staticClass:"mdui-typo-body-1 mdui-text-color-black-text"},[t._v(t._s(t.$t("depot.recognitionSteps."+t.drStep)))])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.drError,expression:"drError"}],staticClass:"result-progress"},[r("div",{staticClass:"mdui-typo-body-1 mdui-text-color-red mdui-p-x-2"},[t._v(t._s(t.drError))])])])]),t.drData||t.drError?r("div",{staticClass:"mdui-row mdui-m-t-2"},[r("div",{staticClass:"mdui-col-xs-6"},[r("label",{directives:[{name:"theme-class",rawName:"v-theme-class",value:["mdui-color-purple","mdui-color-purple-a100 mdui-ripple-black"],expression:"['mdui-color-purple', 'mdui-color-purple-a100 mdui-ripple-black']"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",attrs:{for:"img-select"},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.handleUseFiles(e.dataTransfer.files)}.apply(null,arguments)}}},[t._v(t._s(t.$t("depot.result.selectImage")))])]),r("div",{staticClass:"mdui-col-xs-6"},[r("button",{directives:[{name:"theme-class",rawName:"v-theme-class",value:t.$root.color.pinkBtn,expression:"$root.color.pinkBtn"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",attrs:{disabled:!(t.drData&&t.drData.length)},on:{click:t.importItems}},[t._v(t._s(t.$t("common.import")))])])]):t._e()]:r("label",{staticClass:"image-select pointer mdui-valign mdui-text-center mdui-p-a-4 no-sl",attrs:{for:"img-select"},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.handleUseFiles(e.dataTransfer.files)}.apply(null,arguments)}}},[r("div",{staticClass:"mdui-typo-display-1-opacity mdui-hidden-xs",domProps:{innerHTML:t._s(t.$t("depot.input.title"))}}),r("div",{staticClass:"mdui-typo-headline mdui-hidden-sm-up",staticStyle:{opacity:"0.54"},domProps:{innerHTML:t._s(t.$t("depot.input.title"))}})]),r("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"img-select",accept:"image/jpeg,image/png"},on:{change:function(e){var r=e.target;t.handleUseFiles(r.files),r.value=""}}}),t.debug&&t.drData?r("div",{staticClass:"mdui-m-t-4 no-sl",attrs:{id:"debug"}},[t._l(t.drData,(function(e,a){var i=e.sim,n=e.num,s=e.pos,u=s.x,o=s.y,d=e.debug.scale;return[n?r("div",{key:a,staticClass:"debug-item mdui-m-b-2"},[r("div",{staticClass:"debug-img",style:{backgroundImage:"url("+(t.drImg.src||t.PNG1P)+")",backgroundPosition:"-"+u*d+"px -"+o*d+"px",backgroundSize:"auto "+t.drImg.h*d+"px"}}),r("img",{staticClass:"debug-num-img no-pe mdui-m-r-1",attrs:{src:n.img}}),r("pre",{staticClass:"mdui-m-y-0"},[t._v("item: "+t._s(i.name)+"\nsimi: "+t._s(t.$_.round(100*(1-i.diff),2))+"%\ntext: "+t._s(n.text))])]):t._e()]}))],2):t._e(),t._l(t.drDebug,(function(t,e){return r("img",{key:e,staticClass:"test-img mdui-m-t-2",attrs:{src:t}})}))],2)},n=[],s=r("5530"),u=r("1da1"),o=(r("96cf"),r("d81d"),r("4de4"),r("b0c0"),r("2ca0"),r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("498a"),r("8679")),d=r("60bb"),c=r.n(d),l=r("60fe"),m=r("29d9"),p=r("0e9a"),f=r("989f"),g=(r("ac1f"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("ace4"),r("262e")),v=r.n(g),b=r("2fa1"),h=r("f43e"),w=r("23a9"),y=r.n(w),I=r("3dc1"),x=r("be0f"),k=r.n(x),_=null===(a=/([a-z\d]{8})\.pkg$/.exec(k.a))||void 0===a?void 0:a[1],D=new m["a"]("dr.pkg"),C=null,$=null,S=function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){var e,r,a=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=a.length>0&&void 0!==a[0]&&a[0],!$||e){t.next=3;break}return t.abrupt("return",$);case 3:if(r=function(){try{if(D.getItem("md5")!==_)return;var t=D.getItem("data");if(!t)return;return h["Base64"].toUint8Array(t).buffer}catch(e){console.error("[dr-pkg-cache]",e)}}(),r){t.next=12;break}return t.next=7,fetch(k.a).then((function(t){return t.arrayBuffer()}));case 7:if(r=t.sent,_===y()(r).substr(0,8)){t.next=10;break}throw new Error("Item resource pkg md5 mismatch");case 10:D.setItem("md5",_),D.setItem("data",h["Base64"].fromUint8Array(new Uint8Array(r)));case 12:return C||(C=new v.a),t.next=15,new C.DeportRecognizer(Object(b["transfer"])({order:I,pkg:r},[r]));case 15:return $=t.sent,t.abrupt("return",$);case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=r("de76"),O=new m["a"]("depot"),j={name:"arkn-depot",components:{ArknItem:o["a"]},data:function(){return{MAX_SHOW_DIFF:f["a"],PNG1P:l["c"],materialTable:R["b"],drImg:{src:null,w:0,h:0},drData:null,drSelect:[],drStep:-1,drError:"",drDebug:[],debug:!1}},computed:{itemsWillBeImported:function(){var t=this;return c.a.fromPairs(this.drData.filter((function(e,r){var a=e.sim,i=e.num;return a&&i&&t.drSelect[r]})).map((function(t){var e=t.sim.name,r=t.num.value;return[e,r]})))},drImgRatio:function(){return this.drImg.w/this.drImg.h||0},resultWrapperStyle:function(){var t=this.drImgRatio;return!t||t>4/3?{minWidth:"1000px"}:window.innerWidth>window.innerHeight?{width:"".concat(70*t,"vh"),margin:"auto"}:{}},isDrProcessing:function(){return this.drStep>=0}},methods:{isTrustedResult:f["b"],viewNumToPct:function(t){return c.a.mapValues(t,(function(t){return"".concat(c.a.round(100*t,3),"%")}))},updateStep:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.drStep=t},handleUseFiles:function(t){if(this.$route.path.startsWith("/depot")){var e=Object(p["a"])(t,["image/jpeg","image/png"]);e.length&&this.useImg(e[0])}},useImg:function(t){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function r(){var a,i,n,s,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.drImg.src&&URL.revokeObjectURL(e.drImg.src),a=!!e.drError,e.updateStep(0),e.drError="",e.drData=null,e.drSelect=[],e.drDebug=[],e.drImg={src:URL.createObjectURL(t),w:0,h:0},e.updateImgInfo(),e.$gtag.event("depot_recognition",{event_category:"depot",event_label:"recognition"}),r.prev=10,r.next=13,S(a);case 13:return i=r.sent,r.next=16,i.setDebug(e.debug);case 16:return r.next=18,i.recognize(e.drImg.src,Object(b["proxy"])(e.updateStep));case 18:n=r.sent,s=n.data,u=n.debug,console.log("[dr-result]",Object(f["c"])(s),s),e.drData=c.a.cloneDeep(s),e.drSelect=s.map(f["b"]),e.drDebug=u,setTimeout(e.updateStep),r.next=33;break;case 28:r.prev=28,r.t0=r["catch"](10),console.error("[dr-init]",r.t0),e.drError=String(r.t0),e.updateStep();case 33:case"end":return r.stop()}}),r,null,[[10,28]])})))()},updateImgInfo:function(){var t=this,e=new Image;e.src=this.drImg.src,e.onload=function(){t.drImg.w=e.width,t.drImg.h=e.height}},editResult:function(t){var e=this;this.$prompt("材料数量","修改结果",(function(r){var a=r.trim();/^[0-9]+$/.test(a)?(e.drData[t].num.value=parseInt(a),e.$set(e.drData[t].num,"edit",!0)):e.editResult(t)}),(function(){}),{history:!1,confirmOnEnter:!0,cancelText:this.$t("common.cancel"),confirmText:this.$t("common.edit"),defaultValue:this.drData[t].num.value})},importItems:function(){if(this.$root.importItemsListening)this.$root.$emit("import-items",this.itemsWillBeImported);else{var t=Object(s["a"])(Object(s["a"])({},O.getItem("imports")||{}),this.itemsWillBeImported);O.setItem("imports",t)}this.$snackbar(this.$t("depot.result.imported"))},onScrollResult:function(t){var e=this.$refs.resultScrollable;t.deltaY&&e.scrollWidth>e.clientWidth&&(t.preventDefault(),e.scrollLeft+=t.deltaY)}},created:function(){this.$root.$on("paste-files",this.handleUseFiles),this.debug=!!this.$route.query.debug},beforeDestroy:function(){this.$root.$off("paste-files",this.handleUseFiles)}},E=j,P=(r("db2a"),r("0c7c")),T=Object(P["a"])(E,i,n,!1,null,null,null);e["default"]=T.exports},a5f8:function(t,e,r){},be0f:function(t,e,r){t.exports=r.p+"assets/pkg/item.abf573d4.pkg"},db2a:function(t,e,r){"use strict";r("00d5")},de76:function(t,e,r){"use strict";r.d(e,"b",(function(){return u}));var a=r("5530"),i=(r("07ac"),r("d81d"),r("b0c0"),r("5db7"),r("73d9"),r("60bb")),n=r.n(i),s=r("9d72"),u=n.a.mapValues(s,(function(t,e){return Object(a["a"])({name:e},t)})),o=n.a.sortBy(Object.values(u),"sortId"),d=n.a.groupBy(o,(function(t){var e=t.rare;return e})),c=o.map((function(t){var e=t.name;return e})),l=n.a.flatMap(Object.values(d).reverse(),(function(t){return t.map((function(t){var e=t.name;return e}))}));e["a"]={materials:d,materialTable:u,materialList:o,materialOrder:c,materialRareFirstOrder:l}}}]);